/*
*  Queue class definition. This class is used to manipulate
*  LibreSignage Slide queus. The Queue class uses SlideLists
*  underneath.
*/

var Slide = require('ls-slide').Slide;
var SlideList = require('ls-slidelist').SlideList;
var assert = require('ls-assert').assert;
var APIEndpoints = require('ls-api').APIEndpoints;

class Queue {
	constructor(api) {
		assert(api != null, "API object can't be null.");
		this.api = api;
		this.name = null;
		this.owner = null;
		this.slides = null;
	}

	async load(name) {
		/*
		*  Load the Queue 'name' along with all of its Slides.
		*/
		let loaders = [];
		let resp = null;

		this.name = name;
		this.slides = new SlideList();

		resp = await this.api.call(
			APIEndpoints.QUEUE_GET,
			{'name': name}
		);
		this.owner = resp.owner;

		for (let s of Object.values(resp.slides)) {
			this.slides.slides[s.id] = new Slide(this.api);
			loaders.push(
				this.slides.slides[s.id].load(s.id, false, false)
			);
		}
		return Promise.all(loaders);
	}

	async update() { await this.load(this.name); }

	static async get_queues(api) {
		return (await api.call(APIEndpoints.QUEUE_LIST, null)).queues;
	}
}
exports.Queue = Queue;
