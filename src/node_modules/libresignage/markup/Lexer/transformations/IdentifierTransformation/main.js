var LexerTransformation = require('libresignage/markup/Lexer/LexerTransformation');
var LexerTokenDefs = require('libresignage/markup/Lexer/LexerTokenDefs');

/**
* Subclass of LexerTransformation for concatenating Lexemes.
*
* @memberof module:libresignage/markup
*/
class IdentifierTransformation extends LexerTransformation {
	/**
	* Construct a new IdentifierTransformation.
	*
	* @see {@link module:libresignage/markup.LexerTransformation}
	*/
	constructor(type) {
		super(type);
	}

	/**
	* @see {@link module:libresignage/markup.LexerTransformation#transform}
	*/
	transform(lexemes) {
		let ret = lexemes.slice();

		for (let i = 0; i < ret.length; i++) {
			if (
				ret[i].get_token().get_type() === this.type
				&& ((
					ret.length - 1 >= i + 1
					&& ret[i + 1].get_token().get_type() === 'ASSIGN'
				) || (
					ret.length - 1 >= i + 2
					&& ret[i + 1].get_token().get_type() === 'WHITESPACE'
					&& ret[i + 2].get_token().get_type() === 'ASSIGN'
				))
			) {
				ret[i].ch_type(LexerTokenDefs.get('IDENTIFIER'));
			}
		}

		return ret;
	}
}
module.exports = IdentifierTransformation;
